<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>❤️ 燕燕的休闲小站～ </title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Arial', sans-serif;
        }
        
        /* CSS变量定义 - 主题色系统 */
        :root {
            --primary-color: #ffb6c1;
            --primary-light: #ffccd5;
            --primary-dark: #ff7b9c;
            --accent-color: #ff6b8b;
            --secondary-color: #ff9eb5;
            --text-color: #555;
            --card-bg: white;
            --header-gradient: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            --btn-gradient: linear-gradient(to right, var(--secondary-color), var(--primary-color));
            --wave-gradient: linear-gradient(to top, var(--secondary-color), var(--accent-color));
            --note-bg: #fffacd;
            --modal-bg: rgba(255, 255, 255, 0.95);
            --modal-border: rgba(255, 107, 139, 0.2);
            --modal-btn-bg: var(--accent-color);
            --modal-btn-text: white;
        }
        
        body {
            background-color: #fff5f7;
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* 装饰性爱心 */
        .heart {
            position: absolute;
            font-size: 20px;
            color: var(--secondary-color);
            z-index: -1;
            animation: float 6s infinite ease-in-out;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }
        
        /* 音符漂浮动画 - 音乐动效 */
        .music-note {
            position: fixed;
            font-size: 24px;
            color: var(--accent-color);
            opacity: 0;
            z-index: 9998;
            pointer-events: none;
        }
        
        @keyframes noteFloat {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 0.8;
            }
            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* 音乐可视化 */
        .music-visualizer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100px;
            z-index: 9997;
            opacity: 0.3;
            pointer-events: none;
            display: none;
        }
        
        .visualizer-bar {
            position: absolute;
            bottom: 0;
            width: 8px;
            background: var(--btn-gradient);
            border-radius: 4px 4px 0 0;
            transition: height 0.1s ease;
        }
        
        /* 背景脉动效果 */
        .music-pulse {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            opacity: 0;
            pointer-events: none;
            background: radial-gradient(circle, var(--primary-light) 0%, transparent 70%);
            transition: opacity 0.5s ease;
        }
        
        .pulse-active {
            animation: pulse 2s infinite ease-in-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.1; }
            50% { transform: scale(1.05); opacity: 0.15; }
            100% { transform: scale(1); opacity: 0.1; }
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* 头部样式 */
        header {
            text-align: center;
            padding: 40px 20px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            transition: background 0.3s;
        }
        
        header h1 {
            font-size: 3rem;
            color: var(--accent-color);
            margin-bottom: 10px;
            font-weight: bold;
            letter-spacing: 2px;
        }
        
        /* 主内容区域 */
        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            margin-bottom: 40px;
            transition: all 0.4s ease;
        }
        
        /* 卡片样式 */
        .card {
            background-color: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 182, 193, 0.1);
            width: 100%;
            transform-origin: center top;
            z-index: 1;
        }
        
        /* 卡片聚焦状态 */
        .card.focused {
            position: relative;
            z-index: 100;
            border-color: var(--accent-color);
            box-shadow: 0 15px 40px rgba(255, 107, 139, 0.15);
            transform: translateY(-5px);
            margin: 20px 0;
        }
        
        /* 非聚焦卡片样式 */
        .card:not(.focused):not(:hover) {
            opacity: 0.8;
            transform: scale(0.98);
        }
        
        .card:hover:not(.focused) {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255, 182, 193, 0.1);
            border-color: rgba(255, 182, 193, 0.3);
            opacity: 1;
        }
        
        /* 卡片内容布局 */
        .card-icon {
            font-size: 2.5rem;
            color: var(--secondary-color);
            margin-bottom: 15px;
            text-align: center;
            transition: color 0.3s, transform 0.3s;
            opacity: 0.8;
        }
        
        .card.focused .card-icon {
            transform: scale(1.1);
        }
        
        .card h2 {
            font-size: 1.6rem;
            color: var(--accent-color);
            margin-bottom: 10px;
            text-align: center;
            font-weight: 400;
            letter-spacing: 1px;
        }
        
        .card p {
            color: #777;
            margin-bottom: 20px;
            text-align: center;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        /* 主按钮样式 */
        .card-btn {
            display: block;
            width: 160px;
            margin: 0 auto;
            padding: 12px 20px;
            background: transparent;
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 400;
            letter-spacing: 1px;
            text-decoration: none;
            box-sizing: border-box;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .card-btn:hover {
            background-color: var(--accent-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 139, 0.2);
        }
        
        /* 游戏控制按钮样式 */
        .game-control-btn {
            padding: 10px 25px;
            background: transparent;
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
            border-radius: 50px;
            font-weight: 400;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
            text-decoration: none;
            box-sizing: border-box;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
            margin: 0 auto;
        }
        
        .game-control-btn:hover {
            background-color: var(--accent-color);
            color: white;
            transform: translateY(-2px);
        }
        
        /* 模块内容 */
        .module-content {
            display: none;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.3s, transform 0.3s;
        }
        
        .module-content.active {
            display: block;
            animation: fadeIn 0.5s ease forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* 模块关闭按钮 - 修复位置 */
        .module-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 32px;
            height: 32px;
            background: transparent;
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
            border-radius: 50%;
            font-size: 1rem;
            cursor: pointer;
            display: none; /* 默认隐藏 */
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            z-index: 10;
            opacity: 0.7;
        }
        
        .card.focused .module-close-btn {
            display: flex; /* 聚焦时显示 */
        }
        
        .module-close-btn:hover {
            background-color: var(--accent-color);
            color: white;
            transform: scale(1.1);
            opacity: 1;
        }
        
        /* 关闭提示 */
        .close-hint {
            position: absolute;
            top: 15px;
            right: 55px;
            background-color: rgba(255, 107, 139, 0.1);
            color: var(--accent-color);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            white-space: nowrap;
            display: none;
        }
        
        .card.focused .close-hint {
            display: block; /* 聚焦时显示 */
        }
        
        .module-close-btn:hover + .close-hint {
            opacity: 1;
        }
        
        /* 迷你播放器 */
        .mini-player {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 200px;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            padding: 15px;
            z-index: 9999;
            border: 1px solid var(--accent-color);
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.5s, opacity 0.5s;
            display: none;
        }
        
        .mini-player.show {
            transform: translateY(0);
            opacity: 1;
            display: block;
        }
        
        .mini-player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .mini-player-title {
            font-size: 0.9rem;
            color: var(--accent-color);
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .mini-player-controls {
            display: flex;
            gap: 10px;
        }
        
        .mini-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: transparent;
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
            font-size: 0.8rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .mini-btn:hover {
            background-color: var(--accent-color);
            color: white;
            transform: scale(1.1);
        }
        
        .mini-player-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .mini-song-title {
            font-size: 0.85rem;
            color: var(--text-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }
        
        /* ==================== 主题弹窗样式 ==================== */
        .custom-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .custom-modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background-color: var(--modal-bg);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            border: 1px solid var(--modal-border);
            transform: translateY(-30px);
            transition: transform 0.3s;
            text-align: center;
        }
        
        .custom-modal.show .modal-content {
            transform: translateY(0);
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: var(--accent-color);
            margin-bottom: 15px;
            font-weight: 400;
        }
        
        .modal-message {
            color: var(--text-color);
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        .modal-btn {
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: 400;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid var(--accent-color);
            min-width: 100px;
            font-size: 0.95rem;
        }
        
        .modal-btn.confirm {
            background-color: var(--modal-btn-bg);
            color: var(--modal-btn-text);
        }
        
        .modal-btn.cancel {
            background-color: transparent;
            color: var(--accent-color);
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 139, 0.2);
        }
        
        /* ==================== 首次进入提示语 ==================== */
        .welcome-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 20000;
            transition: opacity 0.8s, visibility 0.8s;
        }
        
        .welcome-content {
            text-align: center;
            max-width: 800px;
            padding: 40px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
            position: relative;
        }
        
        .welcome-text {
            font-size: 2.5rem;
            color: var(--accent-color);
            font-weight: 300;
            line-height: 1.4;
            margin-bottom: 40px;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .typing-cursor {
            display: inline-block;
            width: 3px;
            height: 2.5rem;
            background-color: var(--accent-color);
            margin-left: 5px;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .welcome-close-btn {
            position: absolute;
            top: 30px;
            right: 30px;
            width: 40px;
            height: 40px;
            background: transparent;
            color: var(--accent-color);
            border: 2px solid var(--accent-color);
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            opacity: 0;
            visibility: hidden;
        }
        
        .welcome-close-btn.show {
            opacity: 1;
            visibility: visible;
        }
        
        .welcome-close-btn:hover {
            background-color: var(--accent-color);
            color: white;
            transform: scale(1.1);
        }
        
        .welcome-close-hint {
            margin-top: 20px;
            color: var(--accent-color);
            font-size: 1rem;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .welcome-close-hint.show {
            opacity: 1;
        }
        
        /* ==================== 个性化主题模块优化 ==================== */
        #themeContent .module-inner {
            text-align: center;
            padding-top: 20px;
        }
        
        #themeContent .module-description {
            color: #777;
            margin-bottom: 40px;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        #colorPicker {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        
        .color-option-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .color-option {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 3px solid white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            position: relative;
        }
        
        .color-option:hover {
            transform: scale(1.15);
            box-shadow: 0 6px 18px rgba(0,0,0,0.12);
        }
        
        .color-option.active {
            border: 3px solid var(--accent-color);
            transform: scale(1.2);
            box-shadow: 0 8px 24px rgba(255, 107, 139, 0.2);
        }
        
        .color-option.active::after {
            content: '✓';
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--accent-color);
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
        }
        
        .color-name {
            margin-top: 5px;
            font-size: 0.85rem;
            color: #777;
            font-weight: 400;
            transition: color 0.3s;
        }
        
        .color-option.active + .color-name {
            color: var(--accent-color);
            font-weight: 500;
        }
        
        /* 主题预览区域 */
        .theme-preview {
            margin-top: 50px;
            padding: 30px;
            border-radius: 15px;
            background-color: rgba(255, 182, 193, 0.03);
            border: 1px solid rgba(255, 182, 193, 0.1);
        }
        
        .theme-preview h4 {
            color: var(--accent-color);
            margin-bottom: 20px;
            font-size: 1.1rem;
            font-weight: 400;
        }
        
        .preview-elements {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 15px;
        }
        
        .preview-element {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 8px;
            font-weight: 400;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        /* ==================== 便签模块优化 ==================== */
        #notesContent .module-inner {
            text-align: center;
            padding-top: 20px;
        }
        
        #notesContent .module-description {
            color: #777;
            margin-bottom: 30px;
            font-size: 0.95rem;
        }
        
        .notes-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .note {
            width: 160px;
            height: 160px;
            padding: 15px;
            background-color: var(--note-bg);
            border-radius: 12px;
            box-shadow: 3px 3px 10px rgba(0,0,0,0.05);
            position: relative;
            transform: rotate(-1deg);
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
        }
        
        .note:hover {
            transform: rotate(0deg) scale(1.03);
            box-shadow: 5px 5px 15px rgba(0,0,0,0.08);
        }
        
        .note textarea {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            resize: none;
            font-size: 14px;
            outline: none;
            color: #555;
            font-family: inherit;
            line-height: 1.4;
            flex: 1;
        }
        
        .add-note {
            background: transparent;
            border: 2px dashed var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: var(--primary-color);
            cursor: pointer;
        }
        
        .add-note:hover {
            background-color: rgba(255, 182, 193, 0.1);
        }
        
        /* ==================== 记忆翻牌游戏优化 ==================== */
        #gameContent .module-inner {
            text-align: center;
            padding-top: 20px;
        }
        
        #gameContent .module-description {
            color: #777;
            margin-bottom: 30px;
            font-size: 0.95rem;
        }
        
        .game-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 25px;
        }
        
        .game-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: #777;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.5rem;
            color: var(--accent-color);
            font-weight: 300;
        }
        
        /* 游戏网格优化 */
        #emojiGrid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 0 auto 30px;
            max-width: 320px;
        }
        
        .emoji-card {
            width: 70px;
            height: 70px;
            background-color: rgba(255, 230, 238, 0.5);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s;
            user-select: none;
            border: 1px solid rgba(255, 182, 193, 0.2);
        }
        
        .emoji-card.flipped {
            background-color: var(--primary-color);
            transform: rotateY(180deg);
            border-color: var(--primary-color);
        }
        
        .emoji-card:hover:not(.flipped) {
            background-color: rgba(255, 230, 238, 0.8);
            transform: translateY(-2px);
        }
        
        /* ==================== 猜牌游戏优化 ==================== */
        #guessCardContent .module-inner {
            text-align: center;
            padding-top: 20px;
        }
        
        #guessCardContent .module-description {
            color: #777;
            margin-bottom: 30px;
            font-size: 0.95rem;
        }
        
        /* 难度选择器优化 */
        .difficulty-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .difficulty-btn {
            padding: 10px 20px;
            border: 1px solid var(--primary-color);
            background-color: transparent;
            border-radius: 25px;
            font-weight: 400;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--accent-color);
            text-decoration: none;
            box-sizing: border-box;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }
        
        .difficulty-btn.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .difficulty-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(255, 107, 139, 0.1);
        }
        
        /* 随机选牌动画区域优化 */
        .random-card-animation {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 150px;
            margin: 30px 0;
            position: relative;
        }
        
        .card-slot {
            width: 90px;
            height: 120px;
            background-color: white;
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            font-weight: 300;
            color: #333;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }
        
        /* 随机选牌动画效果 */
        @keyframes cardShuffle {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.05) rotate(-5deg); }
            50% { transform: scale(1) rotate(0deg); }
            75% { transform: scale(1.05) rotate(5deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
        
        .card-shuffling {
            animation: cardShuffle 0.5s ease-in-out infinite;
        }
        
        @keyframes cardReveal {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        
        .card-revealed {
            animation: cardReveal 0.8s ease-out forwards;
        }
        
        /* 游戏状态优化 */
        .game-status {
            text-align: center;
            font-size: 1rem;
            margin: 20px 0 25px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: #777;
            line-height: 1.5;
        }
        
        /* 尝试次数优化 */
        .attempts {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 20px 0;
        }
        
        .attempt-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: rgba(255, 182, 193, 0.2);
            transition: all 0.3s;
        }
        
        .attempt-dot.used {
            background-color: var(--accent-color);
        }
        
        /* 扑克牌选择优化 */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin: 20px auto 30px;
            max-width: 400px;
        }
        
        .card-btn-guess {
            width: 65px;
            height: 85px;
            background-color: white;
            border: 1px solid var(--primary-color);
            border-radius: 8px;
            font-size: 1.3rem;
            font-weight: 300;
            color: #333;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            box-sizing: border-box;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .card-btn-guess:hover:not(.disabled) {
            background-color: rgba(255, 230, 238, 0.5);
            transform: translateY(-3px);
        }
        
        .card-btn-guess.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background-color: rgba(240, 240, 240, 0.5);
        }
        
        .card-btn-guess.selected {
            background-color: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }
        
        /* 游戏结果优化 */
        .game-result {
            text-align: center;
            font-size: 1.1rem;
            font-weight: 300;
            margin: 25px 0;
            padding: 20px;
            border-radius: 12px;
            line-height: 1.6;
        }
        
        .win {
            background-color: rgba(202, 255, 191, 0.2);
            color: #4CAF50;
            border: 1px solid rgba(76, 175, 80, 0.2);
        }
        
        .lose {
            background-color: rgba(255, 182, 193, 0.1);
            color: var(--accent-color);
            border: 1px solid rgba(255, 182, 193, 0.2);
        }
        
        /* ==================== 音乐播放器模块优化 ==================== */
        #musicContent .module-inner {
            text-align: center;
            padding-top: 20px;
        }
        
        #musicContent .module-description {
            color: #777;
            margin-bottom: 30px;
            font-size: 0.95rem;
        }
        
        .music-player {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .song-cover {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
            margin: 0 auto 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
            box-shadow: 0 10px 25px rgba(255, 107, 139, 0.15);
        }
        
        .song-info {
            margin-bottom: 30px;
        }
        
        .song-title {
            font-size: 1.3rem;
            color: var(--accent-color);
            margin-bottom: 5px;
            font-weight: 300;
        }
        
        .song-artist {
            color: #777;
            font-size: 1rem;
        }
        
        .progress-container {
            margin: 25px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background-color: rgba(255, 182, 193, 0.2);
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress {
            height: 100%;
            background: var(--btn-gradient);
            width: 30%;
            border-radius: 2px;
        }
        
        .time-info {
            display: flex;
            justify-content: space-between;
            color: #777;
            font-size: 0.85rem;
        }
        
        .music-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
        }
        
        .music-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: transparent;
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            text-decoration: none;
            box-sizing: border-box;
        }
        
        .music-btn:hover {
            background-color: var(--accent-color);
            color: white;
            transform: scale(1.05);
        }
        
        .music-btn.play-btn {
            width: 60px;
            height: 60px;
            font-size: 1.4rem;
        }
        
        /* 音乐模块最小化按钮 */
        #musicMinimizeBtn {
            right: 55px;
        }
        
        #musicMinimizeHint {
            right: 95px;
        }
        
        /* ==================== 每日一句模块优化 ==================== */
        #quoteContent .module-inner {
            text-align: center;
            padding-top: 20px;
        }
        
        #quoteContent .module-description {
            color: #777;
            margin-bottom: 30px;
            font-size: 0.95rem;
        }
        
        .quote-display {
            max-width: 600px;
            margin: 40px auto;
            padding: 40px;
            border-radius: 15px;
            position: relative;
        }
        
        .quote-text {
            font-size: 1.2rem;
            color: var(--accent-color);
            line-height: 1.6;
            font-style: italic;
            margin-bottom: 25px;
            font-weight: 300;
        }
        
        .quote-author {
            color: #777;
            font-size: 1rem;
            font-weight: 400;
        }
        
        .quote-icon {
            position: absolute;
            font-size: 1.8rem;
            color: rgba(255, 182, 193, 0.3);
        }
        
        .quote-icon.open {
            top: 20px;
            left: 20px;
        }
        
        .quote-icon.close {
            bottom: 20px;
            right: 20px;
        }
        
        /* ==================== 涂鸦板模块优化 ==================== */
        #drawContent .module-inner {
            text-align: center;
            padding-top: 20px;
        }
        
        #drawContent .module-description {
            color: #777;
            margin-bottom: 30px;
            font-size: 0.95rem;
        }
        
        .drawing-tools {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .tool-btn {
            padding: 8px 18px;
            background-color: transparent;
            border: 1px solid var(--primary-color);
            border-radius: 25px;
            color: var(--accent-color);
            font-weight: 400;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            box-sizing: border-box;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 120px;
        }
        
        .tool-btn.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .tool-btn:hover {
            transform: translateY(-2px);
        }
        
        .color-palette {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0 25px;
        }
        
        .color-choice {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }
        
        .color-choice.active {
            border: 2px solid #333;
            transform: scale(1.2);
        }
        
        /* 涂鸦板画布 */
        #drawingCanvas {
            border: 1px solid rgba(255, 182, 193, 0.3);
            border-radius: 10px;
            background-color: white;
            cursor: crosshair;
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.03);
        }
        
        /* 页脚 */
        footer {
            text-align: center;
            padding: 40px 20px;
            margin-top: 40px;
            color: #777;
            border-top: 1px solid rgba(255, 182, 193, 0.2);
        }
        
        footer p {
            margin: 10px 0;
            font-size: 1rem;
            font-weight: 300;
        }
        
        .love-message {
            font-size: 1.1rem;
            margin-top: 15px;
            color: var(--accent-color);
            font-weight: 300;
        }
        
        /* ==================== 响应式设计 ==================== */
        
        /* PC端 - 大屏幕 */
        @media (min-width: 1024px) {
            .main-content {
                grid-template-columns: repeat(3, 1fr);
            }
            
            /* 聚焦卡片在PC端占两列 */
            .card.focused {
                grid-column: span 2;
            }
            
            /* 模块内容在PC端调整 */
            .card.focused .module-content {
                padding: 40px;
            }
            
            /* 游戏网格在PC端调整 */
            #emojiGrid {
                max-width: 360px;
                grid-template-columns: repeat(4, 1fr);
                gap: 15px;
            }
            
            .emoji-card {
                width: 80px;
                height: 80px;
            }
            
            /* 猜牌游戏在PC端调整 */
            .cards-grid {
                max-width: 450px;
                gap: 10px;
            }
            
            .card-btn-guess {
                width: 75px;
                height: 95px;
            }
            
            /* 迷你播放器在PC端调整 */
            .mini-player {
                width: 250px;
            }
        }
        
        /* 平板端 */
        @media (min-width: 768px) and (max-width: 1023px) {
            .main-content {
                grid-template-columns: repeat(2, 1fr);
            }
            
            /* 聚焦卡片在平板端占全宽 */
            .card.focused {
                grid-column: span 2;
                margin: 30px 0;
            }
            
            /* 游戏网格在平板端调整 */
            #emojiGrid {
                max-width: 320px;
                grid-template-columns: repeat(4, 1fr);
                gap: 12px;
            }
            
            .emoji-card {
                width: 70px;
                height: 70px;
            }
        }
        
        /* 手机端 */
        @media (max-width: 767px) {
            header h1 {
                font-size: 2.2rem;
                font-weight: bold;
            }
            
            /* 聚焦卡片在手机端的特殊样式 */
            .card.focused {
                margin: 15px 0;
                padding: 20px;
            }
            
            /* 游戏网格在手机端调整 */
            #emojiGrid {
                grid-template-columns: repeat(4, 1fr);
                gap: 8px;
                max-width: 280px;
            }
            
            .emoji-card {
                width: 60px;
                height: 60px;
                font-size: 1.6rem;
            }
            
            /* 猜牌游戏在手机端调整 */
            .cards-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 6px;
                max-width: 280px;
            }
            
            .card-btn-guess {
                width: 60px;
                height: 80px;
                font-size: 1.1rem;
            }
            
            /* 颜色选择器在手机端调整 */
            #colorPicker {
                gap: 20px;
            }
            
            .color-option {
                width: 50px;
                height: 50px;
            }
            
            /* 便签在手机端调整 */
            .note {
                width: 140px;
                height: 140px;
            }
            
            /* 按钮在手机端调整 */
            .card-btn, .game-control-btn, .difficulty-btn, .tool-btn {
                width: 140px;
                font-size: 0.9rem;
                padding: 10px 15px;
            }
            
            /* 首次进入提示语在手机端调整 */
            .welcome-text {
                font-size: 1.8rem;
                min-height: 100px;
            }
            
            .welcome-content {
                padding: 20px;
                margin: 0 20px;
            }
        }
        
        /* 超小屏幕手机 */
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .card.focused {
                padding: 15px;
            }
            
            #emojiGrid {
                max-width: 240px;
                gap: 6px;
            }
            
            .emoji-card {
                width: 55px;
                height: 55px;
                font-size: 1.4rem;
            }
            
            .cards-grid {
                max-width: 240px;
                gap: 5px;
            }
            
            .card-btn-guess {
                width: 55px;
                height: 75px;
                font-size: 1rem;
            }
            
            .color-option {
                width: 45px;
                height: 45px;
            }
            
            .note {
                width: 120px;
                height: 120px;
            }
            
            /* 按钮在超小屏幕调整 */
            .card-btn, .game-control-btn, .difficulty-btn, .tool-btn {
                width: 130px;
                font-size: 0.85rem;
                padding: 8px 12px;
            }
            
            /* 首次进入提示语在超小屏幕调整 */
            .welcome-text {
                font-size: 1.5rem;
            }
            
            .typing-cursor {
                height: 1.8rem;
            }
        }
        
        /* 聚焦卡片的高亮背景 */
        .card.focused::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: linear-gradient(45deg, var(--primary-light), var(--primary-color));
            border-radius: 25px;
            z-index: -1;
            opacity: 0.05;
        }
        
        /* 聚焦卡片打开时的动画 */
        @keyframes cardFocus {
            0% {
                transform: scale(0.98);
                opacity: 0.9;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .card.focused {
            animation: cardFocus 0.4s ease-out forwards;
        }
        
        /* 隐藏模块的初始状态 */
        .hidden {
            display: none;
        }
        
        /* 模块打开时的卡片内容隐藏 */
        .card.focused > .card-icon,
        .card.focused > h2,
        .card.focused > p,
        .card.focused > .card-btn {
            display: none;
        }
        
        /* 模块打开时的卡片内边距调整 */
        .card.focused .module-content {
            padding: 0;
        }
        
        /* 沉浸式打字机效果 */
        .immersive-typing {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 30000;
            opacity: 1;
            visibility: visible;
            transition: opacity 1s, visibility 1s;
        }
        
        .immersive-typing.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        .typing-container {
            text-align: center;
            max-width: 800px;
            padding: 40px;
        }
        
        .typing-text {
            font-size: 3rem;
            color: white;
            font-weight: 300;
            line-height: 1.4;
            margin-bottom: 40px;
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .typing-close-btn {
            position: absolute;
            top: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            opacity: 0;
            visibility: hidden;
        }
        
        .typing-close-btn.show {
            opacity: 1;
            visibility: visible;
        }
        
        .typing-close-btn:hover {
            background-color: white;
            color: var(--accent-color);
            transform: scale(1.1);
        }
        
        .typing-hint {
            margin-top: 30px;
            color: white;
            font-size: 1.2rem;
            opacity: 0.8;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .typing-hint.show {
            opacity: 0.8;
        }
        
        /* 文字消散效果 */
        @keyframes fadeOutChars {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <!-- 装饰性爱心 -->
    <div id="heartsContainer"></div>
    
    <!-- 音乐动效元素 -->
    <div class="music-visualizer" id="musicVisualizer"></div>
    <div class="music-pulse" id="musicPulse"></div>
    
    <!-- 沉浸式首次进入提示语 -->
    <div class="immersive-typing" id="immersiveTyping">
        <div class="typing-container">
            <div class="typing-text" id="typingText"></div>
            <div class="typing-hint" id="typingHint">点击关闭或等待文字消散</div>
        </div>
        <button class="typing-close-btn" id="typingCloseBtn">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <!-- 自定义弹窗 -->
    <div class="custom-modal" id="customModal">
        <div class="modal-content">
            <h3 class="modal-title" id="modalTitle">提示</h3>
            <p class="modal-message" id="modalMessage">确定要执行此操作吗？</p>
            <div class="modal-buttons">
                <button class="modal-btn confirm" id="modalConfirmBtn">确定</button>
                <button class="modal-btn cancel" id="modalCancelBtn">取消</button>
            </div>
        </div>
    </div>
    
    <!-- 迷你播放器 -->
    <div class="mini-player" id="miniPlayer">
        <div class="mini-player-header">
            <div class="mini-player-title">正在播放</div>
            <div class="mini-player-controls">
                <button class="mini-btn" id="miniPlayBtn">
                    <i class="fas fa-pause"></i>
                </button>
                <button class="mini-btn" id="miniCloseBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="mini-player-info">
            <div class="mini-song-title" id="miniSongTitle">旅雁孤云</div>
        </div>
    </div>
    
    <div class="container">
        <header>
            <h1>H&Z</h1>
        </header>
        
        <div class="main-content">
            <!-- 个性化主题 -->
            <div class="card">
                <div class="card-icon">
                    <i class="fas fa-palette"></i>
                </div>
                <h2>个性化主题</h2>
                <p>选择你喜欢的颜色主题</p>
                <button class="card-btn" id="themeBtn">选择颜色</button>
                
                <div class="module-content" id="themeContent">
                    <button class="module-close-btn">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="close-hint">点击关闭</div>
                    <div class="module-inner">
                        <div class="module-description">
                            选择你喜欢的主题颜色，所有界面元素将随之变化
                        </div>
                        <div id="colorPicker">
                            <div class="color-option-container">
                                <div class="color-option" style="background-color: #ffb6c1;" data-color="#ffb6c1" data-light="#ffccd5" data-dark="#ff7b9c" data-accent="#ff6b8b" data-secondary="#ff9eb5" data-name="浪漫粉"></div>
                                <div class="color-name">浪漫粉</div>
                            </div>
                            <div class="color-option-container">
                                <div class="color-option" style="background-color: #a6e3e9;" data-color="#a6e3e9" data-light="#cbf1f5" data-dark="#71c9ce" data-accent="#00adb5" data-secondary="#71c9ce" data-name="天空蓝"></div>
                                <div class="color-name">天空蓝</div>
                            </div>
                            <div class="color-option-container">
                                <div class="color-option" style="background-color: #c7ceea;" data-color="#c7ceea" data-light="#dae3f2" data-dark="#819aff" data-accent="#5c6bc0" data-secondary="#819aff" data-name="梦幻紫"></div>
                                <div class="color-name">梦幻紫</div>
                            </div>
                            <div class="color-option-container">
                                <div class="color-option" style="background-color: #ffd6a5;" data-color="#ffd6a5" data-light="#ffeda3" data-dark="#ffb26b" data-accent="#ff9a3c" data-secondary="#ffb26b" data-name="温暖橙"></div>
                                <div class="color-name">温暖橙</div>
                            </div>
                            <div class="color-option-container">
                                <div class="color-option" style="background-color: #caffbf;" data-color="#caffbf" data-light="#fdffb6" data-dark="#9bf6ff" data-accent="#a0c4ff" data-secondary="#9bf6ff" data-name="清新绿"></div>
                                <div class="color-name">清新绿</div>
                            </div>
                        </div>
                        <div class="theme-preview">
                            <h4>当前主题预览</h4>
                            <div class="preview-elements">
                                <div class="preview-element" style="background-color: var(--primary-color);">主色调</div>
                                <div class="preview-element" style="background-color: var(--accent-color);">强调色</div>
                                <div class="preview-element" style="border: 1px solid var(--accent-color); color: var(--accent-color); background: transparent;">示例按钮</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 可爱便签 -->
            <div class="card">
                <div class="card-icon">
                    <i class="fas fa-sticky-note"></i>
                </div>
                <h2>可爱便签</h2>
                <p>记录你的想法和待办事项</p>
                <button class="card-btn" id="notesBtn">打开便签</button>
                
                <div class="module-content" id="notesContent">
                    <button class="module-close-btn">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="close-hint">点击关闭</div>
                    <div class="module-inner">
                        <div class="module-description">
                            点击"+"创建新便签，写下你的想法和待办事项
                        </div>
                        <div class="notes-container">
                            <div class="note add-note" id="addNoteBtn">
                                <i class="fas fa-plus"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 记忆翻牌游戏 -->
            <div class="card">
                <div class="card-icon">
                    <i class="fas fa-gamepad"></i>
                </div>
                <h2>记忆翻牌游戏</h2>
                <p>挑战你的记忆力，找到所有相同的表情</p>
                <button class="card-btn" id="gameBtn">开始游戏</button>
                
                <div class="module-content" id="gameContent">
                    <button class="module-close-btn">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="close-hint">点击关闭</div>
                    <div class="module-inner">
                        <div class="module-description">
                            点击卡片翻开表情，找到所有相同的表情对
                        </div>
                        <div class="game-stats">
                            <div class="game-stat">
                                <div class="stat-label">匹配数</div>
                                <div class="stat-value" id="matchCount">0/8</div>
                            </div>
                            <div class="game-stat">
                                <div class="stat-label">尝试次数</div>
                                <div class="stat-value" id="attemptCount">0</div>
                            </div>
                        </div>
                        <div id="emojiGrid"></div>
                        <button class="game-control-btn" id="restartGameBtn">重新开始</button>
                    </div>
                </div>
            </div>
            
            <!-- 猜牌游戏 -->
            <div class="card">
                <div class="card-icon">
                    <i class="fas fa-dice"></i>
                </div>
                <h2>猜牌游戏</h2>
                <p>猜猜我随机抽到了哪张牌？你有3次机会！</p>
                <button class="card-btn" id="guessCardBtn">打开游戏</button>
                
                <div class="module-content" id="guessCardContent">
                    <button class="module-close-btn">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="close-hint">点击关闭</div>
                    <div class="module-inner">
                        <div class="module-description">
                            选择一张牌，猜猜我随机抽到了哪张？你有3次机会！
                        </div>
                        <div id="guessCardGame">
                            <!-- 难度选择 -->
                            <div class="difficulty-selector">
                                <div class="difficulty-btn active" data-difficulty="easy">简单模式</div>
                                <div class="difficulty-btn" data-difficulty="hard">困难模式</div>
                            </div>
                            
                            <!-- 随机选牌动画区域 -->
                            <div class="random-card-animation">
                                <div class="card-slot" id="cardSlot">
                                    ?
                                </div>
                            </div>
                            
                            <!-- 游戏状态 -->
                            <div class="game-status" id="gameStatusText">
                                请先选择难度，然后开始游戏！
                            </div>
                            
                            <!-- 尝试次数 -->
                            <div class="attempts" id="attemptsContainer">
                                <div class="attempt-dot"></div>
                                <div class="attempt-dot"></div>
                                <div class="attempt-dot"></div>
                            </div>
                            
                            <!-- 扑克牌选择 -->
                            <div class="cards-grid" id="cardsGrid">
                                <!-- 卡片将通过JS动态生成 -->
                            </div>
                            
                            <!-- 游戏结果 -->
                            <div id="gameResult" class="hidden"></div>
                            
                            <!-- 操作按钮 -->
                            <button class="game-control-btn" id="startGuessGameBtn">开始新游戏</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 音乐播放器 -->
            <div class="card">
                <div class="card-icon">
                    <i class="fas fa-music"></i>
                </div>
                <h2>放松音乐</h2>
                <p>播放一些轻松的音乐放松心情</p>
                <button class="card-btn" id="musicBtn">打开播放器</button>
                
                <div class="module-content" id="musicContent">
                    <button class="module-close-btn">
                        <i class="fas fa-times"></i>
                    </button>
                    <button class="module-close-btn" id="musicMinimizeBtn">
                        <i class="fas fa-window-minimize"></i>
                    </button>
                    <div class="close-hint" id="musicMinimizeHint">最小化</div>
                    <div class="close-hint">点击关闭</div>
                    <div class="module-inner">
                        <div class="module-description">
                            选择一首音乐，放松心情
                        </div>
                        <div class="music-player">
                            <div class="song-cover">
                                <i class="fas fa-music"></i>
                            </div>
                            <div class="song-info">
                                <div class="song-title" id="currentSongTitle">旅雁孤云</div>
                                <div class="song-artist">纯音乐</div>
                            </div>
                            <div class="progress-container">
                                <div class="progress-bar">
                                    <div class="progress" id="songProgress"></div>
                                </div>
                                <div class="time-info">
                                    <span id="currentTime">0:00</span>
                                    <span id="totalTime">0:00</span>
                                </div>
                            </div>
                            <div class="music-controls">
                                <button class="music-btn" id="prevBtn">
                                    <i class="fas fa-backward"></i>
                                </button>
                                <button class="music-btn play-btn" id="playBtn">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="music-btn" id="nextBtn">
                                    <i class="fas fa-forward"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 每日一句 -->
            <div class="card">
                <div class="card-icon">
                    <i class="fas fa-heart"></i>
                </div>
                <h2>每日一句</h2>
                <p>看看今天有什么暖心的话</p>
                <button class="card-btn" id="quoteBtn">显示今日句子</button>
                
                <div class="module-content" id="quoteContent">
                    <button class="module-close-btn">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="close-hint">点击关闭</div>
                    <div class="module-inner">
                        <div class="module-description">
                            每天一句暖心的话，给你带来好心情
                        </div>
                        <div class="quote-display">
                            <div class="quote-icon open">
                                <i class="fas fa-quote-left"></i>
                            </div>
                            <div class="quote-text" id="quoteText">
                                你是世界上最可爱的人，我每天都感谢命运让我遇见你。
                            </div>
                            <div class="quote-author">— 每日暖心语</div>
                            <div class="quote-icon close">
                                <i class="fas fa-quote-right"></i>
                            </div>
                        </div>
                        <button class="game-control-btn" id="newQuoteBtn">换一句</button>
                    </div>
                </div>
            </div>
            
            <!-- 涂鸦板 -->
            <div class="card">
                <div class="card-icon">
                    <i class="fas fa-paint-brush"></i>
                </div>
                <h2>创意涂鸦</h2>
                <p>在这里随意画画，发挥你的创意</p>
                <button class="card-btn" id="drawBtn">开始涂鸦</button>
                
                <div class="module-content" id="drawContent">
                    <button class="module-close-btn">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="close-hint">点击关闭</div>
                    <div class="module-inner">
                        <div class="module-description">
                            选择画笔颜色和粗细，开始你的创意涂鸦
                        </div>
                        <div class="drawing-tools">
                            <button class="tool-btn active" data-size="2">细笔</button>
                            <button class="tool-btn" data-size="5">中笔</button>
                            <button class="tool-btn" data-size="10">粗笔</button>
                        </div>
                        <div class="color-palette">
                            <div class="color-choice active" style="background-color: #ff6b8b;" data-color="#ff6b8b"></div>
                            <div class="color-choice" style="background-color: #ffb6c1;" data-color="#ffb6c1"></div>
                            <div class="color-choice" style="background-color: #ff9a3c;" data-color="#ff9a3c"></div>
                            <div class="color-choice" style="background-color: #4CAF50;" data-color="#4CAF50"></div>
                            <div class="color-choice" style="background-color: #2196F3;" data-color="#2196F3"></div>
                            <div class="color-choice" style="background-color: #333;" data-color="#333"></div>
                        </div>
                        <canvas id="drawingCanvas" width="300" height="200"></canvas>
                        <div style="margin-top: 20px;">
                            <button class="game-control-btn" id="clearCanvasBtn">清除画板</button>
                            <button class="game-control-btn" id="saveCanvasBtn" style="margin-left: 15px;">保存图片</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Made with ❤️ for H&Z</p>
            <p class="love-message">每一天都因你而美好！</p>
        </footer>
    </div>
    
    <script>
        // ==================== 全局变量 ====================
        let noteDeleteCallback = null;
        let canvasClearCallback = null;
        let typingComplete = false;
        
        // ==================== 沉浸式首次进入提示语 ====================
        function initImmersiveTyping() {
            const immersiveTyping = document.getElementById('immersiveTyping');
            const typingText = document.getElementById('typingText');
            const typingCloseBtn = document.getElementById('typingCloseBtn');
            const typingHint = document.getElementById('typingHint');
            
            // 检查是否已经显示过欢迎信息
            const hasSeenWelcome = localStorage.getItem('hasSeenWelcome');
            
            if (hasSeenWelcome) {
                immersiveTyping.classList.add('hidden');
                return;
            }
            
            // 阻止页面操作
            document.body.style.overflow = 'hidden';
            
            const message = "年岁无忧，快乐常在";
            let index = 0;
            const typingSpeed = 150; // 打字速度(毫秒)
            
            function typeText() {
                if (index < message.length) {
                    typingText.innerHTML = message.substring(0, index + 1) + '<span class="typing-cursor"></span>';
                    index++;
                    setTimeout(typeText, typingSpeed);
                } else {
                    // 打字完成，显示关闭按钮和提示
                    typingComplete = true;
                    setTimeout(() => {
                        typingCloseBtn.classList.add('show');
                        typingHint.classList.add('show');
                        
                        // 添加关闭按钮点击事件
                        typingCloseBtn.addEventListener('click', closeTypingMessage);
                        
                        // 添加自动消散功能
                        setTimeout(() => {
                            autoDismissTypingMessage();
                        }, 5000);
                    }, 500);
                }
            }
            
            function closeTypingMessage() {
                // 保存已查看状态
                localStorage.setItem('hasSeenWelcome', 'true');
                
                // 淡出动画
                immersiveTyping.classList.add('hidden');
                
                // 恢复页面操作
                setTimeout(() => {
                    document.body.style.overflow = 'auto';
                }, 1000);
            }
            
            function autoDismissTypingMessage() {
                if (!typingComplete) return;
                
                // 文字逐个消散效果
                const text = typingText.textContent;
                let dismissIndex = text.length;
                const chars = text.split('');
                
                function dismissText() {
                    if (dismissIndex > 0) {
                        // 创建消散效果
                        const visibleChars = chars.slice(0, dismissIndex - 1);
                        const hiddenChars = chars.slice(dismissIndex - 1);
                        
                        let html = '';
                        visibleChars.forEach(char => {
                            html += `<span>${char}</span>`;
                        });
                        
                        hiddenChars.forEach((char, i) => {
                            const delay = i * 50;
                            html += `<span style="animation: fadeOutChars 0.5s ${delay}ms forwards">${char}</span>`;
                        });
                        
                        typingText.innerHTML = html + '<span class="typing-cursor"></span>';
                        dismissIndex--;
                        setTimeout(dismissText, 50);
                    } else {
                        // 消散完成后关闭
                        setTimeout(closeTypingMessage, 500);
                    }
                }
                
                dismissText();
            }
            
            // 开始打字效果
            setTimeout(typeText, 1000);
        }
        
        // ==================== 自定义弹窗系统 ====================
        function showCustomModal(title, message, confirmText = "确定", cancelText = "取消") {
            return new Promise((resolve) => {
                const modal = document.getElementById('customModal');
                const modalTitle = document.getElementById('modalTitle');
                const modalMessage = document.getElementById('modalMessage');
                const modalConfirmBtn = document.getElementById('modalConfirmBtn');
                const modalCancelBtn = document.getElementById('modalCancelBtn');
                
                // 设置弹窗内容
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                modalConfirmBtn.textContent = confirmText;
                modalCancelBtn.textContent = cancelText;
                
                // 应用主题颜色到弹窗按钮
                const accentColor = getComputedStyle(document.documentElement).getPropertyValue('--accent-color');
                modalConfirmBtn.style.backgroundColor = accentColor;
                modalConfirmBtn.style.borderColor = accentColor;
                
                // 显示弹窗
                modal.classList.add('show');
                
                // 确认按钮事件
                function handleConfirm() {
                    modal.classList.remove('show');
                    resolve(true);
                    removeEventListeners();
                }
                
                // 取消按钮事件
                function handleCancel() {
                    modal.classList.remove('show');
                    resolve(false);
                    removeEventListeners();
                }
                
                // 移除事件监听器
                function removeEventListeners() {
                    modalConfirmBtn.removeEventListener('click', handleConfirm);
                    modalCancelBtn.removeEventListener('click', handleCancel);
                    
                    // 移除ESC键监听
                    document.removeEventListener('keydown', handleEscape);
                }
                
                // ESC键关闭弹窗
                function handleEscape(e) {
                    if (e.key === 'Escape') {
                        handleCancel();
                    }
                }
                
                // 添加事件监听器
                modalConfirmBtn.addEventListener('click', handleConfirm);
                modalCancelBtn.addEventListener('click', handleCancel);
                document.addEventListener('keydown', handleEscape);
            });
        }
        
        // ==================== 音乐动效系统 ====================
        let musicVisualizerInterval = null;
        let noteInterval = null;
        
        function startMusicVisualizer() {
            const visualizer = document.getElementById('musicVisualizer');
            const pulse = document.getElementById('musicPulse');
            
            // 显示可视化效果
            visualizer.style.display = 'block';
            pulse.classList.add('pulse-active');
            
            // 创建可视化条
            visualizer.innerHTML = '';
            const barCount = 30;
            const bars = [];
            
            for (let i = 0; i < barCount; i++) {
                const bar = document.createElement('div');
                bar.className = 'visualizer-bar';
                bar.style.left = `${(i / barCount) * 100}%`;
                bar.style.height = '10px';
                visualizer.appendChild(bar);
                bars.push(bar);
            }
            
            // 更新可视化条高度
            if (musicVisualizerInterval) clearInterval(musicVisualizerInterval);
            
            musicVisualizerInterval = setInterval(() => {
                bars.forEach(bar => {
                    const randomHeight = 10 + Math.random() * 90;
                    bar.style.height = `${randomHeight}px`;
                    bar.style.opacity = 0.3 + Math.random() * 0.5;
                });
            }, 150);
            
            // 开始音符漂浮动画
            startNoteFloating();
        }
        
        function stopMusicVisualizer() {
            const visualizer = document.getElementById('musicVisualizer');
            const pulse = document.getElementById('musicPulse');
            
            // 隐藏可视化效果
            visualizer.style.display = 'none';
            pulse.classList.remove('pulse-active');
            
            // 停止定时器
            if (musicVisualizerInterval) {
                clearInterval(musicVisualizerInterval);
                musicVisualizerInterval = null;
            }
            
            // 停止音符漂浮
            if (noteInterval) {
                clearInterval(noteInterval);
                noteInterval = null;
            }
        }
        
        function startNoteFloating() {
            if (noteInterval) clearInterval(noteInterval);
            
            noteInterval = setInterval(() => {
                createFloatingNote();
            }, 800);
        }
        
        function createFloatingNote() {
            const note = document.createElement('div');
            note.className = 'music-note';
            
            // 随机选择音符图标
            const noteIcons = ['♪', '♫', '♬', '♩', '♭', '♮', '♯'];
            note.textContent = noteIcons[Math.floor(Math.random() * noteIcons.length)];
            
            // 随机位置
            note.style.left = `${Math.random() * 100}vw`;
            note.style.fontSize = `${Math.random() * 20 + 15}px`;
            note.style.opacity = '0.8';
            
            // 随机颜色
            const colors = [
                getComputedStyle(document.documentElement).getPropertyValue('--accent-color'),
                getComputedStyle(document.documentElement).getPropertyValue('--primary-color'),
                getComputedStyle(document.documentElement).getPropertyValue('--secondary-color')
            ];
            note.style.color = colors[Math.floor(Math.random() * colors.length)];
            
            document.body.appendChild(note);
            
            // 动画
            const duration = Math.random() * 4000 + 3000;
            note.style.animation = `noteFloat ${duration}ms linear forwards`;
            
            // 动画结束后移除元素
            setTimeout(() => {
                if (note.parentNode) {
                    note.parentNode.removeChild(note);
                }
            }, duration);
        }
        
        // ==================== 迷你播放器功能 ====================
        function initMiniPlayer() {
            const miniPlayer = document.getElementById('miniPlayer');
            const miniPlayBtn = document.getElementById('miniPlayBtn');
            const miniCloseBtn = document.getElementById('miniCloseBtn');
            const miniSongTitle = document.getElementById('miniSongTitle');
            const musicMinimizeBtn = document.getElementById('musicMinimizeBtn');
            
            // 最小化音乐播放器
            if (musicMinimizeBtn) {
                musicMinimizeBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    minimizeMusicPlayer();
                });
            }
            
            // 迷你播放器播放/暂停
            miniPlayBtn.addEventListener('click', function() {
                if (window.isPlaying) {
                    toggleMusic();
                    miniPlayBtn.innerHTML = '<i class="fas fa-play"></i>';
                } else {
                    toggleMusic();
                    miniPlayBtn.innerHTML = '<i class="fas fa-pause"></i>';
                }
            });
            
            // 关闭迷你播放器
            miniCloseBtn.addEventListener('click', function() {
                hideMiniPlayer();
                // 如果音乐正在播放，停止音乐
                if (window.isPlaying) {
                    toggleMusic();
                }
            });
        }
        
        function minimizeMusicPlayer() {
            // 隐藏音乐模块
            const musicContent = document.getElementById('musicContent');
            const musicBtn = document.getElementById('musicBtn');
            
            musicContent.classList.remove('active');
            musicBtn.textContent = '打开播放器';
            
            // 取消卡片聚焦
            const card = musicContent.closest('.card');
            card.classList.remove('focused');
            restoreGridLayout();
            
            // 显示迷你播放器
            showMiniPlayer();
        }
        
        function showMiniPlayer() {
            const miniPlayer = document.getElementById('miniPlayer');
            const miniSongTitle = document.getElementById('miniSongTitle');
            const miniPlayBtn = document.getElementById('miniPlayBtn');
            
            // 更新迷你播放器信息
            if (window.songs && window.currentSongIndex !== undefined) {
                const song = window.songs[window.currentSongIndex];
                miniSongTitle.textContent = song.title;
            }
            
            // 更新播放按钮状态
            miniPlayBtn.innerHTML = window.isPlaying ? 
                '<i class="fas fa-pause"></i>' : 
                '<i class="fas fa-play"></i>';
            
            // 显示迷你播放器
            setTimeout(() => {
                miniPlayer.classList.add('show');
            }, 300);
        }
        
        function hideMiniPlayer() {
            const miniPlayer = document.getElementById('miniPlayer');
            miniPlayer.classList.remove('show');
        }
        
        function updateMiniPlayerInfo() {
            if (!window.songs || window.currentSongIndex === undefined) return;
            
            const miniSongTitle = document.getElementById('miniSongTitle');
            const song = window.songs[window.currentSongIndex];
            miniSongTitle.textContent = song.title;
        }
        
        // ==================== 模块关闭按钮功能 ====================
        function initModuleCloseButtons() {
            // 为所有模块的关闭按钮添加事件监听
            document.querySelectorAll('.module-close-btn').forEach(closeBtn => {
                // 移除现有事件监听器（避免重复绑定）
                const newCloseBtn = closeBtn.cloneNode(true);
                closeBtn.parentNode.replaceChild(newCloseBtn, closeBtn);
                
                // 为新按钮添加事件监听
                newCloseBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    closeCurrentModule();
                });
            });
        }
        
        function closeCurrentModule() {
            // 找到当前聚焦的卡片
            const focusedCard = document.querySelector('.card.focused');
            if (!focusedCard) return;
            
            // 找到对应的模块
            const module = focusedCard.querySelector('.module-content.active');
            if (!module) return;
            
            // 找到对应的按钮
            const button = focusedCard.querySelector('.card-btn');
            
            // 隐藏模块
            module.classList.remove('active');
            
            // 重置按钮文本
            if (button) {
                // 检查按钮原始文本并恢复
                const buttonId = button.id;
                const originalTexts = {
                    'themeBtn': '选择颜色',
                    'notesBtn': '打开便签',
                    'gameBtn': '开始游戏',
                    'guessCardBtn': '打开游戏',
                    'musicBtn': '打开播放器',
                    'quoteBtn': '显示今日句子',
                    'drawBtn': '开始涂鸦'
                };
                
                if (originalTexts[buttonId]) {
                    button.textContent = originalTexts[buttonId];
                } else {
                    button.textContent = button.textContent.replace('关闭', '打开');
                }
            }
            
            // 取消卡片聚焦
            focusedCard.classList.remove('focused');
            restoreGridLayout();
            
            // 如果是音乐模块且正在播放，最小化而不是停止
            const moduleId = module.id;
            if (moduleId === 'musicContent' && window.isPlaying) {
                minimizeMusicPlayer();
            }
        }
        
        // ==================== 修改后的便签删除功能 ====================
        function initNotesWithCustomModal() {
            document.getElementById('addNoteBtn').addEventListener('click', function() {
                const notesContainer = document.querySelector('.notes-container');
                const noteCount = document.querySelectorAll('.note:not(.add-note)').length;
                
                if (noteCount >= 6) {
                    showCustomModal('提示', '最多只能创建6个便签哦！', '知道了', '').then(() => {
                        // 不需要额外操作
                    });
                    return;
                }
                
                const note = document.createElement('div');
                note.className = 'note';
                note.style.transform = `rotate(${Math.random() * 6 - 3}deg)`;
                
                const textarea = document.createElement('textarea');
                textarea.placeholder = '写下你的想法...';
                
                // 保存便签内容
                textarea.addEventListener('input', function() {
                    saveNotes();
                });
                
                const deleteBtn = document.createElement('button');
                deleteBtn.innerHTML = '×';
                deleteBtn.style.position = 'absolute';
                deleteBtn.style.top = '5px';
                deleteBtn.style.right = '5px';
                deleteBtn.style.background = getComputedStyle(document.documentElement).getPropertyValue('--accent-color');
                deleteBtn.style.color = 'white';
                deleteBtn.style.border = 'none';
                deleteBtn.style.borderRadius = '50%';
                deleteBtn.style.width = '22px';
                deleteBtn.style.height = '22px';
                deleteBtn.style.fontSize = '14px';
                deleteBtn.style.cursor = 'pointer';
                deleteBtn.style.display = 'none';
                
                note.addEventListener('mouseenter', function() {
                    deleteBtn.style.display = 'block';
                });
                
                note.addEventListener('mouseleave', function() {
                    deleteBtn.style.display = 'none';
                });
                
                deleteBtn.addEventListener('click', async function(e) {
                    e.stopPropagation();
                    
                    const confirmed = await showCustomModal(
                        '删除便签', 
                        '确定要删除这个便签吗？',
                        '确定删除',
                        '取消'
                    );
                    
                    if (confirmed) {
                        note.remove();
                        saveNotes();
                    }
                });
                
                note.appendChild(textarea);
                note.appendChild(deleteBtn);
                
                // 在添加按钮前插入新便签
                notesContainer.insertBefore(note, this);
                
                // 聚焦到新便签
                textarea.focus();
                
                saveNotes();
            });
        }
        
        // ==================== 修改后的画板清除功能 ====================
        function initCanvasWithCustomModal() {
            // 修改清除画板功能
            document.getElementById('clearCanvasBtn').addEventListener('click', async function() {
                const confirmed = await showCustomModal(
                    '清除画板', 
                    '确定要清除画板吗？这将删除所有绘画内容。',
                    '确定清除',
                    '取消'
                );
                
                if (confirmed && canvasClearCallback) {
                    canvasClearCallback();
                }
            });
        }
        
        // ==================== 主题系统 ====================
        // 主题配置
        const themeConfigs = {
            'pink': {
                primary: '#ffb6c1',
                light: '#ffccd5',
                dark: '#ff7b9c',
                accent: '#ff6b8b',
                secondary: '#ff9eb5',
                name: '浪漫粉',
                modalBg: 'rgba(255, 255, 255, 0.95)',
                modalBorder: 'rgba(255, 107, 139, 0.2)',
                modalBtnBg: '#ff6b8b',
                modalBtnText: 'white'
            },
            'blue': {
                primary: '#a6e3e9',
                light: '#cbf1f5',
                dark: '#71c9ce',
                accent: '#00adb5',
                secondary: '#71c9ce',
                name: '天空蓝',
                modalBg: 'rgba(255, 255, 255, 0.95)',
                modalBorder: 'rgba(0, 173, 181, 0.2)',
                modalBtnBg: '#00adb5',
                modalBtnText: 'white'
            },
            'purple': {
                primary: '#c7ceea',
                light: '#dae3f2',
                dark: '#819aff',
                accent: '#5c6bc0',
                secondary: '#819aff',
                name: '梦幻紫',
                modalBg: 'rgba(255, 255, 255, 0.95)',
                modalBorder: 'rgba(92, 107, 192, 0.2)',
                modalBtnBg: '#5c6bc0',
                modalBtnText: 'white'
            },
            'orange': {
                primary: '#ffd6a5',
                light: '#ffeda3',
                dark: '#ffb26b',
                accent: '#ff9a3c',
                secondary: '#ffb26b',
                name: '温暖橙',
                modalBg: 'rgba(255, 255, 255, 0.95)',
                modalBorder: 'rgba(255, 154, 60, 0.2)',
                modalBtnBg: '#ff9a3c',
                modalBtnText: 'white'
            },
            'green': {
                primary: '#caffbf',
                light: '#fdffb6',
                dark: '#9bf6ff',
                accent: '#a0c4ff',
                secondary: '#9bf6ff',
                name: '清新绿',
                modalBg: 'rgba(255, 255, 255, 0.95)',
                modalBorder: 'rgba(160, 196, 255, 0.2)',
                modalBtnBg: '#a0c4ff',
                modalBtnText: 'white'
            }
        };
        
        // 保存主题到本地存储
        function saveTheme(themeName) {
            localStorage.setItem('selectedTheme', themeName);
        }
        
        // 加载保存的主题
        function loadTheme() {
            const savedTheme = localStorage.getItem('selectedTheme') || 'pink';
            applyTheme(savedTheme);
            
            // 更新颜色选择器的选中状态
            updateColorPickerSelection(savedTheme);
        }
        
        // 应用主题
        function applyTheme(themeName) {
            const theme = themeConfigs[themeName] || themeConfigs.pink;
            
            // 更新CSS变量
            document.documentElement.style.setProperty('--primary-color', theme.primary);
            document.documentElement.style.setProperty('--primary-light', theme.light);
            document.documentElement.style.setProperty('--primary-dark', theme.dark);
            document.documentElement.style.setProperty('--accent-color', theme.accent);
            document.documentElement.style.setProperty('--secondary-color', theme.secondary);
            document.documentElement.style.setProperty('--modal-bg', theme.modalBg);
            document.documentElement.style.setProperty('--modal-border', theme.modalBorder);
            document.documentElement.style.setProperty('--modal-btn-bg', theme.modalBtnBg);
            document.documentElement.style.setProperty('--modal-btn-text', theme.modalBtnText);
            
            // 更新渐变
            document.documentElement.style.setProperty('--header-gradient', `linear-gradient(135deg, ${theme.primary} 0%, ${theme.light} 100%)`);
            document.documentElement.style.setProperty('--btn-gradient', `linear-gradient(to right, ${theme.secondary}, ${theme.primary})`);
            document.documentElement.style.setProperty('--wave-gradient', `linear-gradient(to top, ${theme.secondary}, ${theme.accent})`);
            
            // 更新所有动态元素的颜色
            updateDynamicElementsColor(theme);
            
            // 重新创建爱心以应用新颜色
            recreateHearts(theme.secondary);
        }
        
        // 更新动态元素的颜色
        function updateDynamicElementsColor(theme) {
            // 更新按钮渐变
            document.querySelectorAll('.card-btn').forEach(btn => {
                btn.style.borderColor = theme.accent;
                btn.style.color = theme.accent;
            });
            
            // 更新游戏控制按钮
            document.querySelectorAll('.game-control-btn').forEach(btn => {
                btn.style.borderColor = theme.accent;
                btn.style.color = theme.accent;
            });
            
            // 更新难度选择按钮
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.style.borderColor = theme.accent;
                btn.style.color = theme.accent;
            });
            
            // 更新工具按钮
            document.querySelectorAll('.tool-btn').forEach(btn => {
                btn.style.borderColor = theme.accent;
                btn.style.color = theme.accent;
            });
            
            // 更新音乐按钮
            document.querySelectorAll('.music-btn').forEach(btn => {
                btn.style.borderColor = theme.accent;
                btn.style.color = theme.accent;
            });
            
            // 更新标题和图标颜色
            document.querySelectorAll('.card h2').forEach(h2 => {
                h2.style.color = theme.accent;
            });
            
            document.querySelectorAll('.card-icon').forEach(icon => {
                icon.style.color = theme.secondary;
            });
            
            // 更新迷你播放器
            const miniPlayer = document.getElementById('miniPlayer');
            if (miniPlayer) {
                miniPlayer.style.borderColor = theme.accent;
            }
            
            // 更新模块关闭按钮
            document.querySelectorAll('.module-close-btn').forEach(btn => {
                btn.style.borderColor = theme.accent;
                btn.style.color = theme.accent;
            });
            
            // 更新自定义弹窗
            const modalContent = document.querySelector('.modal-content');
            if (modalContent) {
                modalContent.style.borderColor = theme.modalBorder;
            }
        }
        
        // 重新创建爱心
        function recreateHearts(color) {
            const container = document.getElementById('heartsContainer');
            container.innerHTML = '';
            
            const heartCount = 20;
            for (let i = 0; i < heartCount; i++) {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.innerHTML = '❤️';
                heart.style.left = Math.random() * 100 + 'vw';
                heart.style.top = Math.random() * 100 + 'vh';
                heart.style.fontSize = (Math.random() * 20 + 15) + 'px';
                heart.style.color = color;
                heart.style.opacity = Math.random() * 0.3 + 0.2;
                heart.style.animationDuration = (Math.random() * 8 + 4) + 's';
                heart.style.animationDelay = Math.random() * 5 + 's';
                container.appendChild(heart);
            }
        }
        
        // 更新颜色选择器选中状态
        function updateColorPickerSelection(themeName) {
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('active');
                const colorValue = option.getAttribute('data-color');
                const theme = themeConfigs[themeName];
                
                if (theme && theme.primary === colorValue) {
                    option.classList.add('active');
                    
                    // 更新主题名称显示
                    const themeNameElement = option.closest('.color-option-container').querySelector('.color-name');
                    if (themeNameElement) {
                        themeNameElement.style.color = theme.accent;
                    }
                } else {
                    const themeNameElement = option.closest('.color-option-container').querySelector('.color-name');
                    if (themeNameElement) {
                        themeNameElement.style.color = '#777';
                    }
                }
            });
        }
        
        // 初始化主题系统
        function initThemeSystem() {
            // 颜色选择器点击事件
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', function() {
                    const colorValue = this.getAttribute('data-color');
                    
                    // 查找对应的主题名称
                    let selectedTheme = 'pink';
                    for (const [themeName, config] of Object.entries(themeConfigs)) {
                        if (config.primary === colorValue) {
                            selectedTheme = themeName;
                            break;
                        }
                    }
                    
                    // 应用主题
                    applyTheme(selectedTheme);
                    saveTheme(selectedTheme);
                    
                    // 更新选中状态
                    updateColorPickerSelection(selectedTheme);
                    
                    // 显示选择反馈
                    this.style.transform = 'scale(1.3)';
                    setTimeout(() => {
                        this.style.transform = 'scale(1.2)';
                    }, 300);
                });
            });
            
            // 加载保存的主题
            loadTheme();
        }
        
        // ==================== 音乐播放器功能 ====================
        // 歌曲数据
        const songs = [
            { 
                title: "旅雁孤云", 
                artist: "垣夜",
                src: "lygy.mp3"
            },
            { 
                title: "助兴", 
                artist: "阿禹ayy&葵Aria",
                src: "zx.mp3"
            },
            { 
                title: "重生之我在异乡为异客", 
                artist: "王睿卓",
                src: "cszwzyxwyk.mp3"
            },
            { 
                title: "远山之外是远山", 
                artist: "余又",
                src: "yszwsys.mp3"
            },
            { 
                title: "怜悯", 
                artist: "周深",
                src: "lm.mp3"
            }
        ];
        
        // 初始化音频
        window.songs = songs;
        window.currentSongIndex = 0;
        window.audio = new Audio(songs[window.currentSongIndex].src);
        window.isPlaying = false;
        window.noteInterval = null;
        window.progressInterval = null;
        
        // 更新歌曲信息
        function updateSongInfo() {
            if (!window.songs || window.currentSongIndex === undefined) return;
            
            const song = window.songs[window.currentSongIndex];
            document.getElementById('currentSongTitle').textContent = song.title;
            document.querySelector('.song-artist').textContent = song.artist || "纯音乐";
            
            // 更新迷你播放器
            updateMiniPlayerInfo();
            
            // 设置音频时长显示
            window.audio.addEventListener('loadedmetadata', function() {
                const totalTime = document.getElementById('totalTime');
                const minutes = Math.floor(window.audio.duration / 60);
                const seconds = Math.floor(window.audio.duration % 60);
                totalTime.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            });
        }
        
        // 更新播放进度
        function updateProgress() {
            if (!window.audio) return;
            
            const progress = document.getElementById('songProgress');
            const currentTime = document.getElementById('currentTime');
            
            if (window.audio.duration) {
                const percent = (window.audio.currentTime / window.audio.duration) * 100;
                progress.style.width = percent + '%';
                
                // 更新当前时间
                const minutes = Math.floor(window.audio.currentTime / 60);
                const seconds = Math.floor(window.audio.currentTime % 60);
                currentTime.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
        }
        
        // 切换音乐播放状态
        function toggleMusic() {
            if (!window.audio) return;
            
            const playBtn = document.getElementById('playBtn');
            const miniPlayBtn = document.getElementById('miniPlayBtn');
            const playIcon = playBtn.querySelector('i');
            
            if (window.isPlaying) {
                window.audio.pause();
                playIcon.className = 'fas fa-play';
                if (miniPlayBtn) {
                    miniPlayBtn.innerHTML = '<i class="fas fa-play"></i>';
                }
                
                // 停止音乐动效
                stopMusicVisualizer();
                
                // 停止进度更新
                if (window.progressInterval) {
                    clearInterval(window.progressInterval);
                    window.progressInterval = null;
                }
            } else {
                window.audio.play().then(() => {
                    playIcon.className = 'fas fa-pause';
                    if (miniPlayBtn) {
                        miniPlayBtn.innerHTML = '<i class="fas fa-pause"></i>';
                    }
                    
                    // 开始音乐动效
                    startMusicVisualizer();
                    
                    // 开始进度更新
                    window.progressInterval = setInterval(updateProgress, 1000);
                }).catch(error => {
                    console.error('播放失败:', error);
                    showCustomModal('播放错误', '无法播放音频，请检查文件路径或网络连接', '知道了', '');
                });
            }
            
            window.isPlaying = !window.isPlaying;
        }
        
        // 切换歌曲
        function changeSong() {
            // 暂停当前音乐
            if (window.isPlaying && window.audio) {
                window.audio.pause();
                window.isPlaying = false;
            }
            
            // 更新播放按钮状态
            const playBtn = document.getElementById('playBtn');
            playBtn.querySelector('i').className = 'fas fa-play';
            
            const miniPlayBtn = document.getElementById('miniPlayBtn');
            if (miniPlayBtn) {
                miniPlayBtn.innerHTML = '<i class="fas fa-play"></i>';
            }
            
            // 停止进度更新
            if (window.progressInterval) {
                clearInterval(window.progressInterval);
                window.progressInterval = null;
            }
            
            // 停止音乐动效
            stopMusicVisualizer();
            
            // 创建新的音频对象
            const song = window.songs[window.currentSongIndex];
            window.audio = new Audio(song.src);
            
            // 设置音频播放结束事件
            window.audio.onended = function() {
                // 自动播放下一首
                window.currentSongIndex = (window.currentSongIndex + 1) % window.songs.length;
                changeSong();
                
                // 如果之前是播放状态，则播放新歌曲
                if (window.wasPlaying) {
                    setTimeout(() => {
                        toggleMusic();
                    }, 500);
                }
            };
            
            // 更新歌曲信息显示
            updateSongInfo();
            
            // 重置进度条
            document.getElementById('songProgress').style.width = '0%';
            document.getElementById('currentTime').textContent = '0:00';
        }
        
        // ==================== 卡片聚焦功能 ====================
        // 聚焦卡片函数
        function focusCard(card) {
            // 移除所有卡片的聚焦状态
            document.querySelectorAll('.card').forEach(c => {
                c.classList.remove('focused');
            });
            
            // 为当前卡片添加聚焦状态
            card.classList.add('focused');
            
            // 调整网格布局以适应聚焦卡片
            adjustGridForFocusedCard();
            
            // 滚动到聚焦卡片的位置
            setTimeout(() => {
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
        }
        
        // 取消所有卡片聚焦
        function unfocusAllCards() {
            document.querySelectorAll('.card').forEach(c => {
                c.classList.remove('focused');
            });
            
            // 恢复网格布局
            restoreGridLayout();
            
            // 如果音乐正在播放，最小化而不是停止
            if (window.isPlaying) {
                minimizeMusicPlayer();
            }
        }
        
        // 调整网格布局以适应聚焦卡片
        function adjustGridForFocusedCard() {
            const mainContent = document.querySelector('.main-content');
            const focusedCard = document.querySelector('.card.focused');
            
            if (!focusedCard) return;
            
            // 获取窗口宽度以确定设备类型
            const windowWidth = window.innerWidth;
            
            // 根据不同设备调整布局
            if (windowWidth >= 1024) {
                // PC端 - 网格调整为2列，聚焦卡片占2列
                mainContent.style.gridTemplateColumns = 'repeat(2, 1fr)';
            } else if (windowWidth >= 768) {
                // 平板端 - 网格调整为1列
                mainContent.style.gridTemplateColumns = '1fr';
            } else {
                // 手机端 - 网格调整为1列
                mainContent.style.gridTemplateColumns = '1fr';
            }
        }
        
        // 恢复网格布局
        function restoreGridLayout() {
            const mainContent = document.querySelector('.main-content');
            const windowWidth = window.innerWidth;
            
            // 根据窗口宽度恢复网格布局
            if (windowWidth >= 1024) {
                mainContent.style.gridTemplateColumns = 'repeat(3, 1fr)';
            } else if (windowWidth >= 768) {
                mainContent.style.gridTemplateColumns = 'repeat(2, 1fr)';
            } else {
                mainContent.style.gridTemplateColumns = '1fr';
            }
        }
        
        // 窗口大小改变时调整布局
        window.addEventListener('resize', function() {
            if (document.querySelector('.card.focused')) {
                adjustGridForFocusedCard();
            } else {
                restoreGridLayout();
            }
        });
        
        // ==================== 模块切换功能 ====================
        // 绑定模块打开按钮
        document.querySelectorAll('.card-btn').forEach(button => {
            if (button.id && button.id.includes('Btn')) {
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    
                    const moduleId = this.id.replace('Btn', 'Content');
                    const module = document.getElementById(moduleId);
                    const card = this.closest('.card');
                    
                    // 如果模块已经显示，则隐藏它并取消聚焦
                    if (module.classList.contains('active')) {
                        module.classList.remove('active');
                        this.textContent = this.textContent.replace('关闭', '打开');
                        card.classList.remove('focused');
                        restoreGridLayout();
                        
                        // 如果是音乐模块且正在播放，最小化而不是停止
                        if (moduleId === 'musicContent' && window.isPlaying) {
                            minimizeMusicPlayer();
                        }
                    } else {
                        // 隐藏所有模块
                        document.querySelectorAll('.module-content').forEach(m => {
                            m.classList.remove('active');
                        });
                        
                        // 重置所有按钮文本
                        document.querySelectorAll('.card-btn').forEach(btn => {
                            const btnModuleId = btn.id.replace('Btn', 'Content');
                            if (btn.id !== this.id && document.getElementById(btnModuleId)) {
                                // 恢复原始文本
                                const buttonId = btn.id;
                                const originalTexts = {
                                    'themeBtn': '选择颜色',
                                    'notesBtn': '打开便签',
                                    'gameBtn': '开始游戏',
                                    'guessCardBtn': '打开游戏',
                                    'musicBtn': '打开播放器',
                                    'quoteBtn': '显示今日句子',
                                    'drawBtn': '开始涂鸦'
                                };
                                
                                if (originalTexts[buttonId]) {
                                    btn.textContent = originalTexts[buttonId];
                                } else {
                                    btn.textContent = btn.textContent.replace('关闭', '打开');
                                }
                            }
                        });
                        
                        // 显示当前模块并聚焦卡片
                        module.classList.add('active');
                        this.textContent = this.textContent.replace('打开', '关闭');
                        focusCard(card);
                    }
                    
                    // 模块特定初始化
                    switch(moduleId) {
                        case 'gameContent':
                            if (!window.gameInitialized) {
                                initMemoryGame();
                                window.gameInitialized = true;
                            }
                            break;
                        case 'guessCardContent':
                            if (!window.guessCardInitialized) {
                                initGuessCardGame();
                                window.guessCardInitialized = true;
                            }
                            break;
                        case 'drawContent':
                            if (!window.canvasInitialized) {
                                initDrawingCanvas();
                                window.canvasInitialized = true;
                            }
                            break;
                        case 'musicContent':
                            if (!window.musicInitialized) {
                                updateSongInfo();
                                window.musicInitialized = true;
                            }
                            break;
                    }
                });
            }
        });
        
        // 点击卡片外部区域取消聚焦
        document.addEventListener('click', function(event) {
            const card = event.target.closest('.card');
            const button = event.target.closest('.card-btn');
            const moduleCloseBtn = event.target.closest('.module-close-btn');
            const modal = event.target.closest('.custom-modal');
            
            // 如果点击的是弹窗，不执行关闭操作
            if (modal) return;
            
            // 如果点击的是卡片外部且不是按钮或关闭按钮
            if (!card && !button && !moduleCloseBtn) {
                // 隐藏所有模块
                document.querySelectorAll('.module-content').forEach(m => {
                    m.classList.remove('active');
                });
                
                // 重置所有按钮文本
                document.querySelectorAll('.card-btn').forEach(btn => {
                    // 恢复原始文本
                    const buttonId = btn.id;
                    const originalTexts = {
                        'themeBtn': '选择颜色',
                        'notesBtn': '打开便签',
                        'gameBtn': '开始游戏',
                        'guessCardBtn': '打开游戏',
                        'musicBtn': '打开播放器',
                        'quoteBtn': '显示今日句子',
                        'drawBtn': '开始涂鸦'
                    };
                    
                    if (originalTexts[buttonId]) {
                        btn.textContent = originalTexts[buttonId];
                    } else {
                        btn.textContent = btn.textContent.replace('关闭', '打开');
                    }
                });
                
                // 取消卡片聚焦
                unfocusAllCards();
            }
        });
        
        // ==================== 便签功能 ====================
        // 保存便签到本地存储
        function saveNotes() {
            const notes = [];
            document.querySelectorAll('.note textarea').forEach((textarea, index) => {
                if (textarea.parentElement.id !== 'addNoteBtn') {
                    notes.push({
                        text: textarea.value
                    });
                }
            });
            localStorage.setItem('cuteNotes', JSON.stringify(notes));
        }
        
        // 加载便签
        function loadNotes() {
            const savedNotes = JSON.parse(localStorage.getItem('cuteNotes') || '[]');
            const notesContainer = document.querySelector('.notes-container');
            const addNoteBtn = document.getElementById('addNoteBtn');
            
            savedNotes.forEach(noteData => {
                const note = document.createElement('div');
                note.className = 'note';
                note.style.transform = `rotate(${Math.random() * 6 - 3}deg)`;
                
                const textarea = document.createElement('textarea');
                textarea.value = noteData.text;
                
                textarea.addEventListener('input', function() {
                    saveNotes();
                });
                
                const deleteBtn = document.createElement('button');
                deleteBtn.innerHTML = '×';
                deleteBtn.style.position = 'absolute';
                deleteBtn.style.top = '5px';
                deleteBtn.style.right = '5px';
                deleteBtn.style.background = getComputedStyle(document.documentElement).getPropertyValue('--accent-color');
                deleteBtn.style.color = 'white';
                deleteBtn.style.border = 'none';
                deleteBtn.style.borderRadius = '50%';
                deleteBtn.style.width = '22px';
                deleteBtn.style.height = '22px';
                deleteBtn.style.fontSize = '14px';
                deleteBtn.style.cursor = 'pointer';
                deleteBtn.style.display = 'none';
                
                note.addEventListener('mouseenter', function() {
                    deleteBtn.style.display = 'block';
                });
                
                note.addEventListener('mouseleave', function() {
                    deleteBtn.style.display = 'none';
                });
                
                deleteBtn.addEventListener('click', async function(e) {
                    e.stopPropagation();
                    
                    const confirmed = await showCustomModal(
                        '删除便签', 
                        '确定要删除这个便签吗？',
                        '确定删除',
                        '取消'
                    );
                    
                    if (confirmed) {
                        note.remove();
                        saveNotes();
                    }
                });
                
                note.appendChild(textarea);
                note.appendChild(deleteBtn);
                
                notesContainer.insertBefore(note, addNoteBtn);
            });
        }
        
        // ==================== 记忆翻牌游戏 ====================
        function initMemoryGame() {
            const emojis = ['🐶', '🐱', '🐰', '🦊', '🐻', '🐼', '🐨', '🐯', '🐶', '🐱', '🐰', '🦊', '🐻', '🐼', '🐨', '🐯'];
            const gameGrid = document.getElementById('emojiGrid');
            const matchCountElement = document.getElementById('matchCount');
            const attemptCountElement = document.getElementById('attemptCount');
            
            let flippedCards = [];
            let matchedPairs = 0;
            let attempts = 0;
            let gameStarted = false;
            
            // 洗牌算法
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
            
            function createGameBoard() {
                gameGrid.innerHTML = '';
                const shuffledEmojis = shuffleArray([...emojis]);
                
                shuffledEmojis.forEach(emoji => {
                    const card = document.createElement('div');
                    card.className = 'emoji-card';
                    card.dataset.emoji = emoji;
                    card.innerHTML = '❓';
                    
                    card.addEventListener('click', () => flipCard(card));
                    gameGrid.appendChild(card);
                });
                
                matchCountElement.textContent = `0/8`;
                attemptCountElement.textContent = `0`;
                flippedCards = [];
                matchedPairs = 0;
                attempts = 0;
                gameStarted = true;
            }
            
            function flipCard(card) {
                if (!gameStarted) return;
                
                // 如果卡片已经翻转或匹配，则忽略点击
                if (card.classList.contains('flipped') || flippedCards.length >= 2) {
                    return;
                }
                
                // 翻转卡片
                card.classList.add('flipped');
                card.innerHTML = card.dataset.emoji;
                flippedCards.push(card);
                
                // 如果翻转了两张卡片，检查是否匹配
                if (flippedCards.length === 2) {
                    attempts++;
                    attemptCountElement.textContent = attempts;
                    
                    const [card1, card2] = flippedCards;
                    
                    if (card1.dataset.emoji === card2.dataset.emoji) {
                        // 匹配成功
                        matchedPairs++;
                        matchCountElement.textContent = `${matchedPairs}/8`;
                        flippedCards = [];
                        
                        // 检查游戏是否结束
                        if (matchedPairs === emojis.length / 2) {
                            setTimeout(() => {
                                showCustomModal(
                                    '游戏胜利', 
                                    `恭喜！你找到了所有匹配的对子！🎉\n尝试次数：${attempts}`,
                                    '再玩一次',
                                    '关闭'
                                ).then((result) => {
                                    if (result) {
                                        createGameBoard();
                                    }
                                });
                                gameStarted = false;
                            }, 500);
                        }
                    } else {
                        // 不匹配，翻转回去
                        setTimeout(() => {
                            card1.classList.remove('flipped');
                            card2.classList.remove('flipped');
                            card1.innerHTML = '❓';
                            card2.innerHTML = '❓';
                            flippedCards = [];
                        }, 1000);
                    }
                }
            }
            
            // 初始化游戏板
            createGameBoard();
            
            // 重新开始按钮
            document.getElementById('restartGameBtn').addEventListener('click', createGameBoard);
        }
        
        // ==================== 音乐播放器绑定 ====================
        document.getElementById('playBtn').addEventListener('click', toggleMusic);
        
        document.getElementById('prevBtn').addEventListener('click', function() {
            if (!window.songs || window.songs.length === 0) return;
            
            window.currentSongIndex = (window.currentSongIndex - 1 + window.songs.length) % window.songs.length;
            changeSong();
        });
        
        document.getElementById('nextBtn').addEventListener('click', function() {
            if (!window.songs || window.songs.length === 0) return;
            
            window.currentSongIndex = (window.currentSongIndex + 1) % window.songs.length;
            changeSong();
        });
        
        // ==================== 每日一句功能 ====================
        const quotes = [
            { text: "你是世界上最可爱的人，我每天都感谢命运让我遇见你。", author: "爱你的我" },
            { text: "你的微笑是我一天中最期待看到的画面。", author: "爱你的我" },
            { text: "和你在一起的每一刻，都是我生命中最美好的时光。", author: "爱你的我" },
            { text: "你的存在让我的世界变得完整而美好。", author: "爱你的我" },
            { text: "无论发生什么，我都会一直爱你、支持你。", author: "爱你的我" },
            { text: "你的善良和温柔让我每天都感到幸福。", author: "爱你的我" },
            { text: "感谢你出现在我的生命里，让我的世界充满阳光。", author: "爱你的我" },
            { text: "你是我心中最特别的人，无人可以替代。", author: "爱你的我" },
            { text: "和你在一起的每一天都像是情人节。", author: "爱你的我" },
            { text: "希望你年岁无忧，快乐常在。", author: "爱你的我" },
            { text: "你的快乐就是我最大的幸福。", author: "爱你的我" }
        ];
        
        function displayRandomQuote() {
            const randomIndex = Math.floor(Math.random() * quotes.length);
            const quote = quotes[randomIndex];
            document.getElementById('quoteText').textContent = quote.text;
            document.querySelector('.quote-author').textContent = `— ${quote.author}`;
        }
        
        document.getElementById('newQuoteBtn').addEventListener('click', displayRandomQuote);
        
        // ==================== 涂鸦板功能 ====================
        function initDrawingCanvas() {
            const canvas = document.getElementById('drawingCanvas');
            const ctx = canvas.getContext('2d');
            const clearBtn = document.getElementById('clearCanvasBtn');
            const saveBtn = document.getElementById('saveCanvasBtn');
            const toolBtns = document.querySelectorAll('.tool-btn');
            const colorChoices = document.querySelectorAll('.color-choice');
            
            // 设置初始画笔属性
            let currentColor = '#ff6b8b';
            let currentSize = 2;
            let drawing = false;
            let lastX = 0;
            let lastY = 0;
            
            // 调整画布大小
            function resizeCanvas() {
                const container = canvas.parentElement;
                const maxWidth = Math.min(container.clientWidth - 40, 500);
                
                canvas.width = maxWidth;
                canvas.height = maxWidth * 0.66;
                
                // 重新绘制白色背景
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
            
            // 设置画笔
            function setBrush(color, size) {
                currentColor = color;
                currentSize = size;
                ctx.strokeStyle = currentColor;
                ctx.lineWidth = currentSize;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
            }
            
            // 开始绘画
            function startDrawing(e) {
                drawing = true;
                [lastX, lastY] = getMousePos(canvas, e);
                
                // 开始新路径
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
            }
            
            // 绘画过程
            function draw(e) {
                if (!drawing) return;
                
                e.preventDefault();
                
                const [x, y] = getMousePos(canvas, e);
                
                // 绘制线条
                ctx.lineTo(x, y);
                ctx.stroke();
                
                [lastX, lastY] = [x, y];
            }
            
            // 停止绘画
            function stopDrawing() {
                if (drawing) {
                    ctx.closePath();
                    drawing = false;
                }
            }
            
            // 获取鼠标位置
            function getMousePos(canvas, evt) {
                const rect = canvas.getBoundingClientRect();
                let clientX, clientY;
                
                if (evt.type.includes('touch')) {
                    clientX = evt.touches[0].clientX;
                    clientY = evt.touches[0].clientY;
                } else {
                    clientX = evt.clientX;
                    clientY = evt.clientY;
                }
                
                return [
                    clientX - rect.left,
                    clientY - rect.top
                ];
            }
            
            // 清除画布
            function clearCanvas() {
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
            
            // 保存画布为图片
            function saveCanvas() {
                const link = document.createElement('a');
                link.download = '我的涂鸦.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            }
            
            // 设置清除回调函数
            canvasClearCallback = clearCanvas;
            
            // 事件监听器
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // 触摸事件支持
            canvas.addEventListener('touchstart', function(e) {
                e.preventDefault();
                startDrawing(e);
            });
            
            canvas.addEventListener('touchmove', function(e) {
                e.preventDefault();
                draw(e);
            });
            
            canvas.addEventListener('touchend', stopDrawing);
            
            saveBtn.addEventListener('click', saveCanvas);
            
            // 工具按钮事件
            toolBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    toolBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentSize = parseInt(this.dataset.size);
                    setBrush(currentColor, currentSize);
                });
            });
            
            // 颜色选择事件
            colorChoices.forEach(choice => {
                choice.addEventListener('click', function() {
                    colorChoices.forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    currentColor = this.dataset.color;
                    setBrush(currentColor, currentSize);
                });
            });
            
            // 初始调整画布大小和设置画笔
            resizeCanvas();
            setBrush(currentColor, currentSize);
            window.addEventListener('resize', resizeCanvas);
        }
        
        // ==================== 猜牌游戏功能 ====================
        let guessCardGame = {
            difficulty: 'easy',
            targetCard: null,
            attempts: 3,
            usedAttempts: 0,
            gameActive: false,
            animationInProgress: false,
            
            // 扑克牌值顺序（从小到大）
            cardOrder: ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'],
            cardOrderWithJokers: ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', '小王', '大王'],
            
            // 初始化游戏
            init: function() {
                // 难度选择按钮事件
                document.querySelectorAll('.difficulty-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.difficulty = btn.dataset.difficulty;
                        this.updateGameStatus(`已选择${btn.textContent}，点击"开始新游戏"按钮开始！`);
                        this.resetGame();
                        this.createCardButtons();
                    });
                });
                
                // 开始新游戏按钮
                document.getElementById('startGuessGameBtn').addEventListener('click', () => this.startNewGame());
                
                // 创建扑克牌按钮
                this.createCardButtons();
                
                // 初始状态
                this.updateGameStatus("请选择难度，然后开始游戏！");
                this.updateAttemptsDisplay();
            },
            
            // 创建扑克牌按钮
            createCardButtons: function() {
                const cardsGrid = document.getElementById('cardsGrid');
                cardsGrid.innerHTML = '';
                
                const cards = this.difficulty === 'easy' ? this.cardOrder : this.cardOrderWithJokers;
                const accentColor = getComputedStyle(document.documentElement).getPropertyValue('--accent-color');
                const secondaryColor = getComputedStyle(document.documentElement).getPropertyValue('--secondary-color');
                
                cards.forEach(card => {
                    const cardBtn = document.createElement('button');
                    cardBtn.className = 'card-btn-guess disabled';
                    cardBtn.textContent = card;
                    cardBtn.dataset.card = card;
                    cardBtn.disabled = true;
                    
                    // 根据卡片值设置不同颜色
                    if (card === '大王' || card === '小王') {
                        cardBtn.style.color = accentColor;
                    } else if (card === 'J' || card === 'Q' || card === 'K') {
                        cardBtn.style.color = secondaryColor;
                    } else if (card === 'A') {
                        cardBtn.style.color = '#4CAF50';
                    }
                    
                    cardBtn.addEventListener('click', () => this.guessCard(card));
                    cardsGrid.appendChild(cardBtn);
                });
            },
            
            // 开始新游戏
            startNewGame: function() {
                if (this.animationInProgress) return;
                
                this.resetGame();
                
                // 开始随机选牌动画
                this.startRandomCardAnimation();
            },
            
            // 随机选牌动画
            startRandomCardAnimation: function() {
                this.animationInProgress = true;
                const cardSlot = document.getElementById('cardSlot');
                const cards = this.difficulty === 'easy' ? this.cardOrder : this.cardOrderWithJokers;
                
                // 随机选择一张目标牌
                this.targetCard = cards[Math.floor(Math.random() * cards.length)];
                
                // 开始洗牌动画
                cardSlot.textContent = '?';
                cardSlot.classList.add('card-shuffling');
                this.updateGameStatus(`正在随机选择一张牌...`);
                
                // 模拟洗牌效果
                let shuffleCount = 0;
                const maxShuffles = 12;
                const shuffleInterval = setInterval(() => {
                    if (shuffleCount < maxShuffles) {
                        // 显示随机牌（确保不显示目标牌）
                        let randomCard;
                        do {
                            randomCard = cards[Math.floor(Math.random() * cards.length)];
                        } while (randomCard === this.targetCard && cards.length > 1);
                        
                        cardSlot.textContent = randomCard;
                        shuffleCount++;
                    } else {
                        // 停止洗牌动画
                        clearInterval(shuffleInterval);
                        cardSlot.classList.remove('card-shuffling');
                        cardSlot.textContent = '?';
                        
                        // 开始游戏
                        this.gameActive = true;
                        this.animationInProgress = false;
                        this.updateGameStatus(`游戏开始！我已随机选择了一张牌。你有${this.attempts}次机会猜中它！`);
                        this.setCardButtonsEnabled(true);
                    }
                }, 150);
            },
            
            // 重置游戏
            resetGame: function() {
                this.targetCard = null;
                this.usedAttempts = 0;
                this.gameActive = false;
                
                // 重置卡片按钮状态
                const cardButtons = document.querySelectorAll('.card-btn-guess');
                cardButtons.forEach(btn => {
                    btn.classList.remove('selected');
                    btn.classList.add('disabled');
                    btn.disabled = true;
                });
                
                // 隐藏游戏结果
                const gameResult = document.getElementById('gameResult');
                gameResult.classList.add('hidden');
                gameResult.innerHTML = '';
                
                // 重置卡槽显示
                const cardSlot = document.getElementById('cardSlot');
                cardSlot.textContent = '?';
                cardSlot.classList.remove('card-shuffling', 'card-revealed');
                
                // 更新尝试次数显示
                this.updateAttemptsDisplay();
            },
            
            // 设置卡片按钮是否可用
            setCardButtonsEnabled: function(enabled) {
                const cardButtons = document.querySelectorAll('.card-btn-guess');
                cardButtons.forEach(btn => {
                    if (enabled) {
                        btn.classList.remove('disabled');
                        btn.disabled = false;
                    } else {
                        btn.classList.add('disabled');
                        btn.disabled = true;
                    }
                });
            },
            
            // 猜牌
            guessCard: function(guessedCard) {
                if (!this.gameActive || this.usedAttempts >= this.attempts) return;
                
                // 标记已选择的卡片
                const cardButtons = document.querySelectorAll('.card-btn-guess');
                cardButtons.forEach(btn => {
                    btn.classList.remove('selected');
                    if (btn.dataset.card === guessedCard) {
                        btn.classList.add('selected');
                    }
                });
                
                this.usedAttempts++;
                this.updateAttemptsDisplay();
                
                // 检查是否猜中
                if (guessedCard === this.targetCard) {
                    this.gameWin();
                    return;
                }
                
                // 如果没有猜中且还有机会
                if (this.usedAttempts < this.attempts) {
                    const hint = this.getHint(guessedCard);
                    this.updateGameStatus(`第${this.usedAttempts}次尝试：你猜的是${guessedCard}，${hint} 再试试！`);
                } else {
                    this.gameLose();
                }
            },
            
            // 获取提示
            getHint: function(guessedCard) {
                const cards = this.difficulty === 'easy' ? this.cardOrder : this.cardOrderWithJokers;
                const guessedIndex = cards.indexOf(guessedCard);
                const targetIndex = cards.indexOf(this.targetCard);
                
                if (guessedIndex === -1 || targetIndex === -1) return "无法判断";
                
                const diff = targetIndex - guessedIndex;
                
                if (this.difficulty === 'easy') {
                    if (diff > 0) {
                        return diff <= 2 ? `比${guessedCard}大一点点` : `比${guessedCard}大的多`;
                    } else {
                        return Math.abs(diff) <= 2 ? `比${guessedCard}小一点点` : `比${guessedCard}小的多`;
                    }
                } else {
                    if (diff > 0) {
                        return diff <= 2 ? `比${guessedCard}大的多` : `比${guessedCard}大一点点`;
                    } else {
                        return Math.abs(diff) <= 2 ? `比${guessedCard}小的多` : `比${guessedCard}小一点点`;
                    }
                }
            },
            
            // 游戏胜利
            gameWin: function() {
                this.gameActive = false;
                this.setCardButtonsEnabled(false);
                
                const cardSlot = document.getElementById('cardSlot');
                cardSlot.textContent = this.targetCard;
                cardSlot.classList.add('card-revealed');
                
                const resultDiv = document.getElementById('gameResult');
                resultDiv.innerHTML = `
                    <div class="game-result win">
                        恭喜！你猜对了！🎉<br>
                        目标牌是：${this.targetCard}<br>
                        你用了${this.usedAttempts}次机会！
                    </div>
                `;
                resultDiv.classList.remove('hidden');
                
                this.updateGameStatus(`太棒了！你猜对了！目标牌是${this.targetCard}`);
            },
            
            // 游戏失败
            gameLose: function() {
                this.gameActive = false;
                this.setCardButtonsEnabled(false);
                
                const cardSlot = document.getElementById('cardSlot');
                cardSlot.textContent = this.targetCard;
                cardSlot.classList.add('card-revealed');
                
                const resultDiv = document.getElementById('gameResult');
                resultDiv.innerHTML = `
                    <div class="game-result lose">
                        很遗憾，机会用完了！😢<br>
                        目标牌是：${this.targetCard}<br>
                        点击"开始新游戏"再来一局！
                    </div>
                `;
                resultDiv.classList.remove('hidden');
                
                this.updateGameStatus(`机会用完了！目标牌是${this.targetCard}`);
            },
            
            // 更新游戏状态文本
            updateGameStatus: function(text) {
                document.getElementById('gameStatusText').innerHTML = text;
            },
            
            // 更新尝试次数显示
            updateAttemptsDisplay: function() {
                const attemptDots = document.querySelectorAll('.attempt-dot');
                attemptDots.forEach((dot, index) => {
                    if (index < this.usedAttempts) {
                        dot.classList.add('used');
                    } else {
                        dot.classList.remove('used');
                    }
                });
            }
        };
        
        // 初始化猜牌游戏
        function initGuessCardGame() {
            guessCardGame.init();
        }
        
        // ==================== 创建装饰性爱心 ====================
        function createHearts() {
            const container = document.getElementById('heartsContainer');
            const heartCount = 20;
            
            for (let i = 0; i < heartCount; i++) {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.innerHTML = '❤️';
                heart.style.left = Math.random() * 100 + 'vw';
                heart.style.top = Math.random() * 100 + 'vh';
                heart.style.fontSize = (Math.random() * 20 + 15) + 'px';
                heart.style.opacity = Math.random() * 0.3 + 0.2;
                heart.style.animationDuration = (Math.random() * 8 + 4) + 's';
                heart.style.animationDelay = Math.random() * 5 + 's';
                container.appendChild(heart);
            }
        }
        
        // ==================== 页面初始化 ====================
        window.addEventListener('DOMContentLoaded', () => {
            createHearts();
            loadNotes();
            initThemeSystem();
            initModuleCloseButtons();
            initMiniPlayer();
            initNotesWithCustomModal();
            initCanvasWithCustomModal();
            initImmersiveTyping();
            
            // 随机显示一个每日一句
            displayRandomQuote();
            
            // 初始化变量
            window.wasPlaying = false;
            window.musicInitialized = false;
            window.gameInitialized = false;
            window.guessCardInitialized = false;
            window.canvasInitialized = false;
        });
    </script>
</body>
</html>
